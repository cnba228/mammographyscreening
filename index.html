<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Access to Annual Screening, Georgia 2018</title>
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
		integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
	<!-- Leaflet CSS -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
		integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
		crossorigin="" />
	<!-- Fonts -->
	<!-- <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,800;1,800&display=swap"
		rel="stylesheet"> -->

        <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v0.35.1/mapbox-gl.css" rel='stylesheet' />
        <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.35.1/mapbox-gl.js"></script>
        <script src="/js/leaflet-mapbox-gl.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"
            integrity="sha512-rKFvwjvE4liWPlFnvH4ZhRDfNZ9FOpdkD/BU5gAIA3VS3vOQrQ5BjKgbO3kxebKhHdHcNUHLqxQYSoxee9UwgA=="
            crossorigin="anonymous">
         </script>

	<style>
		body {
			background: #20282e;
			font-family: 'Open Sans', sans-serif;
			font-weight: 400;
		}

		h1 {
			font-weight: 800;
		}

        h2{
            font-size: x-small;
        }
		p {
			line-height: 1.7rem;
		}

		#map {
			height: 80vh;
			background: #9bcbf0;
		}

		#legend {
			font-size: 1rem;
			border-radius: 5px;
			max-width: 200px;
			font-family: 'Open Sans', sans-serif;
		}

		#legend span {
			width: 20px;
			height: 20px;
			float: left;
			margin: 0 10px 4px 0;
		}

		#legend label {
			font-size: 0.9rem;
		}

		#legend label:after {
			content: '';
			display: block;
			clear: both;
		}

		@media (min-width: 576px) {}

		@media (min-width: 768px) {

			aside {
				height: 80vh;
			}
		}

		@media (min-width: 992px) {}

		@media (min-width: 1200px) {}
	</style>

</head>

<body>
	<div class="container-fluid">
		<header class="row bg-light text-black py-3">
			<div class="col">
				<h1>Access to Annual Screening, Georgia 2018</h1>
               
			</div>
		</header>

		<section class="row">
			<div class="col-md-8 col-lg-9 col-xl-10 order-md-2 px-0">
				<div id="map"></div>
			</div>
			<aside id="about"
				class="col-md-4 col-lg-3 col-xl-2 order-md-1 text-white py-3 pl-3 bg-secondary overflow-auto">
				<section>
					<p>Mammography screening for breast cancer is widely available in many countries. Initially praised as a universal
                        achievement to improve women's health and to reduce the burden of breast cancer, the benefits and harms of
                        mammography screening have been debated heatedly as overdiagnosis becomes an ever increasing topic of concern.</p>
                   <br><br>
                        <p>Overdiagnosis in mammographic screening for breast
                            cancer in Europe: a literature review<a href="https://pubmed.ncbi.nlm.nih.gov/22972810/"> (Puliti et al., 2012)</a><p>
                    <p>Benefits and harms of mammography screening <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4415291/"> (Loeberg et al., 2015)</a></p>
				</section>
			</aside>
		</section>

		<footer class="row bg-light text-black py-3">
			<div class="col">
				<ul class="list-unstyled">
					<li>Authored by <a href="https://github.com/cnba228">Caitlin Baer</a></li>
					<li>University of Kentucky New Maps Plus 2021</li>
					<li>Data source: <a href="www.data.gov">Data.gov</a></li>
				</ul>
			</div>
		</footer>
	</div>

    <!-- option values   -->
	<div class="bg-secondary py-2 px-3 ml-3 mt-3 text-white" id="legend"></div>
	<div class="form-group mr-3 mt-3" id="dropdown-ui">
		<select class="form-control bg-primary text-white">
            <option value="HC01_EST_VC18">All Demographics</option>
			<option value="HC03_EST_VC17" selected>Non-Hispanic White Women</option>
			<option value="HC04_EST_VC17">Non-Hispanic Black Women</option>
			<option value="HC01_EST_VC18">Hispanic Women</option>
            <option value="HC01_EST_VC18">Asian Women</option>
		</select>
	</div>

	<script src="https://code.jquery.com/jquery-3.5.1.min.js"
		integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
		integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"
		integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF"
		crossorigin="anonymous"></script>
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
		integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
		crossorigin=""></script>
	<script src='https://unpkg.com/simple-statistics@7.7.0/dist/simple-statistics.min.js'></script>
	<script>
		const options = {
			zoomSnap: .1,
			
		}
		

		const map = L.map('map', options);
		L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
			attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
		}).addTo(map);

    
$.getJSON("data/or-counties.json", function (counties) {

        Papa.parse('data/or-unemployment-rates.csv', {
         download: true,
        header: true,
        complete: function (data) {
        console.log('data: ', data);
        console.log('counties: ', counties);
         processData(counties, data);

  }
});

})

		let attributeValue = "HC03_EST_VC17";
		const normValue = "HC04_EST_VC17";

		
		const labels = {
			"HC03_EST_VC17": "Percent Screened non-Hispanic White",
			"HC04_EST_VC17": "Percent Not Screened non-Hispanic Black",
			"HC01_EST_VC18": "Unable to determine"
		}

		$.getJSON("data/mammographyscreeninggeorgia.json", function (data) {
			
			
			drawMap(data);
		});

function drawMap(data) {
const counties = L.geoJson(data, {
  style: function (feature) {
    return {
      color: '#20282e',
      weight: 1,
      fillOpacity: 1,
      fillColor: '#1f78b4'
    };
  },

  // hover functionality
  onEachFeature: function (feature, layer) {

    // mouse over
    layer.on('mouseover', function () {
      layer.setStyle({
        color: '#ff6e00'
      }).bringToFront();
    });

    // on mousing off layer
    layer.on('mouseout', function () {

      // reset the layer style to its original stroke color
      layer.setStyle({
        color: '#20282e'
      });
    });
  }
}).addTo(map);

map.fitBounds(counties.getBounds(), {
  padding: [18, 18] // thickness around borders
});

addUi(counties)
updateMap(counties)
addLegend()
		}



function updateMap(counties) {
  console.log(counties);

  const breaks = getClassBreaks(counties);
    counties.eachLayer(function (layer) {

    const props = layer.feature.properties;
    layer.setStyle({
      fillColor: getColor(props[attributeValue] /
        props[normValue], breaks)
    });


    let tooltipInfo = `<b>${props["NAME"]} County</b></br>
            ${((props[attributeValue] / props[normValue]) * 100).toLocaleString()}%`

    layer.bindTooltip(tooltipInfo, {
      sticky: true
    });

  });

updateLegend(breaks);
}
		

function getClassBreaks(counties) {

const values = [];
counties.eachLayer(function (layer) {
  let value = layer.feature.properties[attributeValue] / layer.feature.properties[normValue];
  values.push(value); 
});

const clusters = ss.ckmeans(values, 4);

const breaks = clusters.map(function (cluster) {
  return [cluster[0], cluster.pop()];
});

return breaks;
}


function getColor(d, breaks) {

if (d <= breaks[0][1]) {
  return '#f1eef6';
} else if (d <= breaks[1][1]) {
  return '#bdc9e1';
} else if (d <= breaks[2][1]) {
  return '#74a9cf';
} else if (d <= breaks[3][1]) {
  return '#2b8cbe'
} else if (d <= breaks[4][1]) {
  return '#045a8d'
}
}


function addLegend(breaks) {

  const legendControl = L.control({ position: 'bottomleft' });
  legendControl.onAdd = function() {

    const legend = L.DomUtil.get('legend');
    L.DomEvent.disableScrollPropagation(legend);
    L.DomEvent.disableClickPropagation(legend);
    return legend;

  };

  legendControl.addTo(map);

function updateLegend() {
  const legend = $('#legend').html(`<h5>${labels[attributeValue]}</h5>`);
  for (let i = 0; i <= breaks.length - 1; i++) {

    let color = getColor(breaks[i][0], breaks);

    legend.append(
      `<span style="background:${color}"></span>
      <label>${(breaks[i][0] * 100).toLocaleString()} &mdash;
      ${(breaks[i][1] * 100).toLocaleString()}%</label>`);
  }
}}


		

function addUi() {
  var selectControl = L.control({ position: "topright" });
  selectControl.onAdd = function() {
    return L.DomUtil.get("dropdown-ui");
  };
  selectControl.addTo(map);
}
$('#dropdown-ui select').change(function() {
  attributeValue = this.value;
  updateMap();
});

	</script>
</body>

</html>